<script src="../libs/bootstrap-datepicker.js"></script>
<script src="../libs/bootstrap-datepicker.zh-CN.min.js"></script>
<script src="../libs/jquery.ztree.core.js"></script>
<script src="../libs/jquery.ztree.excheck.js"></script>
<script type="text/javascript">
    <!--
    var setting = {
        check: {
            enable: true,
            chkboxType: {"Y":"", "N":""}
        },
        view: {
            dblClickExpand: false
        },
        data: {
            simpleData: {
                enable: true
            }
        },
        callback: {
            beforeClick: beforeClick,
            onCheck: onCheck
        }
    };
    var zNodes =[
        {id:1, pId:0, name:"逆变器", open:true, nocheck:true},
        {id:11, pId:1, name:"IV2CFD4669"},
        {id:12, pId:1, name:"IV2CFD4669"},
        {id:13, pId:1, name:"IV2CFD4669"},
        {id:14, pId:1, name:"IV2CFD4669"},
        {id:2, pId:0, name:"汇流箱", open:true, nocheck:true},
        {id:21, pId:2, name:"IV2CFD4669"},
        {id:22, pId:2, name:"IV2CFD4669"},
        {id:23, pId:2, name:"IV2CFD4669"},
        {id:24, pId:2, name:"IV2CFD4669"},
        {id:3, pId:0, name:"环境检测仪", open:true, nocheck:true},
        {id:31, pId:3, name:"IV2CFD4669"},
        {id:32, pId:3, name:"IV2CFD4669"},
        {id:33, pId:3, name:"IV2CFD4669"},
        {id:34, pId:3, name:"IV2CFD4669"}
    ];
    function beforeClick(treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj("treeDemo");
        zTree.checkNode(treeNode, !treeNode.checked, null, true);
        return false;
    }

    function onCheck(e, treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
                nodes = zTree.getCheckedNodes(true),
                v = "";
        for (var i=0, l=nodes.length; i<l; i++) {
            v += nodes[i].name + ",";
        }
        if (v.length > 0 ) v = v.substring(0, v.length-1);
        var cityObj = $("#citySel");
        cityObj.attr("value", v);
    }
    function showMenu() {
        var cityObj = $("#citySel");
        var cityOffset = $("#citySel").offset();
        $("#menuContent").css({left:cityOffset.left + "px", top:cityOffset.top + cityObj.outerHeight() + "px"}).slideDown("fast");
        $("body").bind("mousedown", onBodyDown);
    }
    function hideMenu() {
        $("#menuContent").fadeOut("fast");
        $("body").unbind("mousedown", onBodyDown);
    }
    function onBodyDown(event) {
        if (!(event.target.id == "menuBtn" || event.target.id == "citySel" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {
            hideMenu();
        }
    }
    $(document).ready(function(){
        $.fn.zTree.init($("#treeDemo"), setting, zNodes);
    });
    //-->
</script>
<script>
    $(function(){
        $('.date-picker').datepicker({
            language: 'zh-CN',
            autoclose: true,
            startView: 2,
            maxViewMode: 2,
            minViewMode:2,
            format: 'yyyy'
        });

        $("#timeType").change(function(){
            $('.date-picker').val('');
            var type=$('#timeType option:selected').text();
            if(type === '年'){
                $('.date-picker').datepicker('remove');
                $('.date-picker').datepicker({
                    language: 'zh-CN',
                    autoclose: true,
                    startView: 2,
                    maxViewMode: 2,
                    minViewMode:2,
                    format: 'yyyy'
                })
            }else if(type === '月'){
                $('.date-picker').datepicker('remove');
                $('.date-picker').datepicker({
                    format: 'yyyy-mm',
                    autoclose: true,
                    todayBtn: true,
                    minViewMode: 1,
                    language:  'zh-CN'
                })
            }else{
                $('.date-picker').datepicker('remove');
                $('.date-picker').datepicker({
                    language: 'zh-CN',
                    autoclose: true,
                    format: 'yyyy-mm-dd'
                })
            }
        })
        $("#timeType1").change(function(){
            $('.date-picker').val('');
            var type=$('#timeType1 option:selected').text();
            if(type === '年'){
                $('.date-picker').datepicker('remove');
                $('.date-picker').datepicker({
                    language: 'zh-CN',
                    autoclose: true,
                    startView: 2,
                    maxViewMode: 2,
                    minViewMode:2,
                    format: 'yyyy'
                })
            }else if(type === '月'){
                $('.date-picker').datepicker('remove');
                $('.date-picker').datepicker({
                    format: 'yyyy-mm',
                    autoclose: true,
                    todayBtn: true,
                    minViewMode: 1,
                    language:  'zh-CN'
                })
            }else{
                $('.date-picker').datepicker('remove');
                $('.date-picker').datepicker({
                    language: 'zh-CN',
                    autoclose: true,
                    format: 'yyyy-mm-dd'
                })
            }
        })
    })
</script>
<div>
    <div class="bg-light lter b-b wrapper-md">
        <div class="row">
            <div class="col-sm-6 col-xs-12">
                <p>当前位置：<a ui-sref="app.dashboard-v1">首页</a>><a ui-sref="app.dashboard-v1">智能监控></a>设备导出</p>
            </div>
        </div>
    </div>
    <div class="wrapper-md">
        <div class="row wrapper power">
            <form class="clearfix export" style="margin: 0 20px;">
                <div class="col-md-3">
                    <label>时间类型</label>
                    <select id="timeType" name="timeType" style="width: 70%;background: #a9aeb9;border: none;">
                        <option value="year">年</option>
                        <option value="month">月</option>
                        <option value="day">日</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label>选择时间</label>
                    <input name="time" class="date-picker" style="width: 70%;background: #a9aeb9;border: none;height: 23px;">
                </div>
                <div class="col-md-3">
                    <label>电站名称</label>
                    <select name="stationName" style="width: 70%;background: #a9aeb9;border: none;">
                        <option>电站名称一</option>
                        <option>电站名称二</option>
                        <option>电站名称三</option>
                    </select>
                </div>
                <div class="col-md-2 col-md-offset-1" style="text-align: right;">
                    <button id="generateTable">导出</button>
                </div>
            </form>
        </div>
        <div class="row wrapper power" style="min-height: 410px;">
            <form class="clearfix export" style="margin: 0 20px;">
                <div class="col-md-2">
                    <label>时间类型</label>
                    <select id="timeType1" name="timeType" style="width: 65%;background: #a9aeb9;border: none;">
                        <option value="year">年</option>
                        <option value="month">月</option>
                        <option value="day">日</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label>选择时间</label>
                    <input name="time" class="date-picker" style="width: 65%;background: #a9aeb9;border: none;height: 23px;">
                </div>
                <div class="col-md-2">
                    <label>电站名称</label>
                    <select name="stationName" style="width: 65%;background: #a9aeb9;border: none;">
                        <option>电站名称一</option>
                        <option>电站名称二</option>
                        <option>电站名称三</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <div class="zTreeDemoBackground left">
                        <div class="list">
                            <label>设备选择</label>
                            <input id="citySel" type="text" readonly value="" style="width: 65%;background: #a9aeb9;border: none;height: 23px;" onclick="showMenu();return false;" />
                        </div>
                    </div>
                </div>
                <div id="menuContent" class="menuContent" style="display:none; position: absolute;">
                    <ul id="treeDemo" class="ztree" style="margin-top:0; width:180px; height: 300px;background: #fff;"></ul>
                </div>
                <div class="col-md-2 col-md-offset-2" style="text-align: right;">
                    <button id="generateTable1">导出</button>
                </div>
            </form>
        </div>
    </div>
</div>
